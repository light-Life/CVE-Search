#Author: huayang

import json
import requests
import urllib.parse

print("""选择要扫描的类型：
    1 【自动合并】（软件名和版本请分别放入name.txt、number.txt）
    2 【已合并】
    """)
number = input('请输入数字:')
def name():
    urls = open('name.txt')
    for text in urls.readlines():
        data = text.strip('\n')
        yield data
def nmb():
    urls = open('number.txt')
    for text in urls.readlines():
        data1 = text.strip('\n')
        yield data1
if number == '1':
    for i, a in zip(name(), nmb()):
        data = i + ' ' +a
        query = 'https://services.nvd.nist.gov/rest/json/cves/1.0?keyword=' + urllib.parse.quote(data, 'utf-8') + '&resultsPerPage=40'
        try:
            response = requests.get(query)
            if 'totalResults":0' in response.text:
                print('\033[1;31m[-] 暂未查询到漏洞\033[0m',data)
            else:
                with open('test.txt', 'a') as f:
                    f.write('\n----------------------------------------------------------------------------------\n' + data + '\n')
                res = json.loads((response.content).decode('utf-8'))
                print('\033[1;32m[+] 这个版本存在大约',res["totalResults"],'个漏洞\033[0m',data)
                for i in range(res['totalResults']):
                    print('\t--',res['result']['CVE_Items'][i]['cve']['CVE_data_meta']['ID'])
                    with open('test.txt', 'a') as f:
                        f.write('\t' + res['result']['CVE_Items'][i]['cve']['CVE_data_meta']['ID'] + '\n')
        except Exception as e:
            print(e)
            pass
elif number == '2':
    urls = open('data.txt')
    for text in urls.readlines():
        data = text.strip('\n')
        query = 'https://services.nvd.nist.gov/rest/json/cves/1.0?keyword=' + urllib.parse.quote(data,'utf-8') + '&resultsPerPage=40'
        try:
            response = requests.get(query)
            if 'totalResults":0' in response.text:
                print('\033[1;31m[-] 暂未查询到漏洞\033[0m', data)
            else:
                with open('test.txt', 'a') as f:
                    f.write(
                        '\n----------------------------------------------------------------------------------\n' + data + '\n')
                res = json.loads((response.content).decode('utf-8'))
                print('\033[1;32m[+] 这个版本存在大约', res["totalResults"], '个漏洞\033[0m', data)
                for i in range(res['totalResults']):
                    print('\t--', res['result']['CVE_Items'][i]['cve']['CVE_data_meta']['ID'])
                    with open('test.txt', 'a') as f:
                        f.write('\t' + res['result']['CVE_Items'][i]['cve']['CVE_data_meta']['ID'] + '\n')
        except Exception as e:
            print(e)
            pass
else:
    print('请输入正确的扫描类型')